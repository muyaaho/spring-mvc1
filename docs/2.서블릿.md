## 프로젝트 생성

### 스프링 프로젝트 생성

- Packaging: War 선택

<br>

### Intellij Gradle 대신 자바 직접 실행

- Preferences → Build, Execution, Deployment → Build Tools → Gradle
    - Build and run using: Gradle IntelliJ IDEA
    - Run tests using: Gradle IntelliJ IDEA

단 intellij 무료 버전인 경우 `build.gradle`에서 `providedRuntime 'org.springframework.boot:spring-boot-starter-tomcat'` 다음 코드를 제거해야 한다. 

<br>

### 롬복 적용

1. Preferences → plugin → lombok 검색 실행 (재시작)
2. Preferences → Annotation Processors 검색 → Enable annotation processing 체크 (재시작)

<br>

### Postman 설치

<br><br>

## Hello 서블릿

스프링 부트 환경에서 서블릿을 등록하고 사용해 보자.

- 스프링 부트가 톰캣 서버를 내장하고 있으므로, 톰캣 서버 설치 없이 편리하게 서블릿 코드를 실행할 수 있다.

<br>

### 스프링 부트 서블릿 환경 구성

`@ServletComponentScan` 등록

```java
@ServletComponentScan		// 서블릿 사용 등록
@SpringBootApplication
public class ServletApplication {

	public static void main(String[] args) {
		SpringApplication.run(ServletApplication.class, args);
	}

}

```

#### 서블릿 등록하기

`Ctrl + O` : 오버라이드 가능한 메소드 목록을 확인해 코드를 자동으로 생성해 준다.

여기서는 `protected` 메서드를 생성한다.(자물쇠 모양이 잠겨있다.)

```java
@WebServlet(name = "helloServlet", urlPatterns = "/hello")
public class HelloServlet extends HttpServlet {
    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        System.out.println("HelloServlet.service");
        System.out.println("request = " + request);
        System.out.println("response = " + response);

        String username = request.getParameter("username");
        System.out.println("username = " + username);

        response.setContentType("text/plain");
        response.setCharacterEncoding("utf-8");
        response.getWriter().write("hello " + username);
    }
}
```

- `@WebServlet`: 서블릿 어노테이션
    - name: 서블릿 이름
    - urlPatterns: URL 매핑
- HTTP 요청을 통해 매핑된 URL이 호출되면 서블릿 컨테이너는 다음 메서드를 실행한다.
    
    `protected void service(HttpServletRequest request, HttpServletResponse response){`
    
- 웹 브라우저 실행
    - `http://localhost:8080/username=kim`
    
    ```java
    HelloServlet.service
    request = org.apache.catalina.connector.RequestFacade@3c2b6443
    response = org.apache.catalina.connector.ResponseFacade@d7efa5f
    username = kim
    ```
    
- `@ServletComponentScan` 등록 후 에러 발생할 때
    - https://www.inflearn.com/questions/1085960
- 개발자 모드에서 결과 확인하기 (`F12`)
    
    <img src=https://github.com/muyaaho/spring-mvc1/assets/76798969/cec25495-3fd1-4120-958f-b7c59f75e1be width="80%" height="80%"/><br>

    - `HelloServlet` 클래스의 `service` 메서드에서 설정한 정보들을 확인할 수 있다.
        
        ```java
                response.setContentType("text/plain");
                response.setCharacterEncoding("utf-8");
                response.getWriter().write("hello " + username);
        ```
        

<br>

### HTTP 요청 메시지 로그로 확인하기

`application.properties`에 다음 설정을 추가하자

```
logging.level.org.apache.coyote.http11=trace
```

서버를 다시 시작하면 서버가 받은 HTTP 요청 메시지를 확인할 수 있다.

```
Host: localhost:8080
Connection: keep-alive
Cache-Control: max-age=0
sec-ch-ua: "Google Chrome";v="125", "Chromium";v="125", "Not.A/Brand";v="24"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "Windows"
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate, br, zstd
Accept-Language: ko,ko-KR;q=0.9,en-US;q=0.8,en;q=0.7
```

> **참고**
운영 서버에 이렇게 정보를 다 남기면 성능저하가 발생할 수 있다. 개발 단계에서만 적용하자.
> 

<br>

### [서블릿 컨테이너 동작 방식 설명](https://github.com/muyaaho/spring-mvc1/blob/main/docs/1.%EC%8A%A4%ED%94%84%EB%A7%81%20%EC%9B%B9%20MVC.md#%EC%84%9C%EB%B8%94%EB%A6%BF-1)

<br><br>

## HttpServletRequest - 개요

### HttpServletRequest 역할

HTTP 요청 메시지를 개발자가 직접 파싱해도 되지만 그렇게 되면 개발자는 매우 불편할 것이다. 서블릿은 개발자가 HTTP 요청 메시지를 편리하게 사용할 수 있도록 개발자 대신 HTTP 요청 메시지를 파싱한다. 그리고 그 결과를 `HttpServletRequest` 객체에 담아 제공한다.

<br>

### [HTTP 요청 메시지](https://github.com/muyaaho/http-basic/blob/main/docs/3.http.md#http-%EB%A9%94%EC%8B%9C%EC%A7%80)

```
POST /save HTTP/1.1
Host: localhost:8080
Content-Type: application/x-www-form-urlencoded

username=kim&age=20
```

- [START LINE](https://github.com/muyaaho/http-basic/blob/main/docs/3.http.md#start-line-%EC%8B%9C%EC%9E%91-%EB%9D%BC%EC%9D%B8)
    - HTTP 메서드
    - URL
    - 쿼리 스트링
    - 스키마, 프로토콜
- [헤더](https://github.com/muyaaho/http-basic/blob/main/docs/3.http.md#header-%ED%97%A4%EB%8D%94)
    - 헤더 조회
- [바디](https://github.com/muyaaho/http-basic/blob/main/docs/3.http.md#message-body-%EB%A9%94%EC%8B%9C%EC%A7%80-%EB%B0%94%EB%94%94)
    - form 파라미터 형식 조회
    - message body 데이터 직접 조회

<br><br>

## HttpServletRequest - 기본 사용법

#### start-line 정보

```java
private static void printStartLine(HttpServletRequest request) {
    System.out.println("--- REQUEST-LINE - start ---");
    System.out.println("request.getMethod() = " + request.getMethod()); //GET
    System.out.println("request.getProtocol() = " + request.getProtocol()); //HTTP/1.1
    System.out.println("request.getScheme() = " + request.getScheme()); //http
    // http://localhost:8080/request-header
    System.out.println("request.getRequestURL() = " + request.getRequestURL());
    // /request-header
    System.out.println("request.getRequestURI() = " + request.getRequestURI());
    //username=hi
    System.out.println("request.getQueryString() = " +
            request.getQueryString());
    System.out.println("request.isSecure() = " + request.isSecure()); //https 사용        유무
    System.out.println("--- REQUEST-LINE - end ---");
    System.out.println();
}
```

```
--- REQUEST-LINE - start ---
request.getMethod() = GET
request.getProtocol() = HTTP/1.1
request.getScheme() = http
request.getRequestURL() = http://localhost:8080/request-header
request.getRequestURI() = /request-header
request.getQueryString() = null
request.isSecure() = false
--- REQUEST-LINE - end ---
```

쿼리문을 작성하면 `request.getQueryString() = null`에 내용이 들어간다.

```java
http://localhost:8080/request-header?username=hello
```

```
--- REQUEST-LINE - start ---
request.getMethod() = GET
request.getProtocol() = HTTP/1.1
request.getScheme() = http
request.getRequestURL() = http://localhost:8080/request-header
request.getRequestURI() = /request-header
request.getQueryString() = username=hello
request.isSecure() = false
--- REQUEST-LINE - end ---
```

#### 헤더 정보

```java
    //Header 모든 정보
    private void printHeaders(HttpServletRequest request) {
        System.out.println("--- Headers - start ---");
        Enumeration<String> headerNames = request.getHeaderNames();
        while (headerNames.hasMoreElements()) {
            String headerName = headerNames.nextElement();
            System.out.println(headerName + ": " + headerName);
        }
        System.out.println("--- Headers - end ---");
        System.out.println();
    }
```

```java
// or
        System.out.println("--- Headers - start ---");
				// iterator 사용
        request.getHeaderNames().asIterator().forEachRemaining(headerName -> System.out.println(headerName + ": " + headerName));

        System.out.println("--- Headers - end ---");
```

```
--- Headers - start ---
host: host
connection: connection
cache-control: cache-control
sec-ch-ua: sec-ch-ua
sec-ch-ua-mobile: sec-ch-ua-mobile
sec-ch-ua-platform: sec-ch-ua-platform
upgrade-insecure-requests: upgrade-insecure-requests
user-agent: user-agent
accept: accept
sec-fetch-site: sec-fetch-site
sec-fetch-mode: sec-fetch-mode
sec-fetch-user: sec-fetch-user
sec-fetch-dest: sec-fetch-dest
accept-encoding: accept-encoding
accept-language: accept-language
--- Headers - end ---

```

#### Header 편리한 조회

```
--- Header 편의 조회 start ---
[Host 편의 조회]
request.getServerName() = localhost
request.getServerPort() = 8080

[Accept-Language 편의 조회]
locale = ko
locale = ko_KR
locale = en_US
locale = en
request.getLocale() = ko

[cookie 편의 조회]

[Content 편의 조회]
request.getContentType() = null
request.getContentLength() = -1
request.getCharacterEncoding() = UTF-8
--- Header 편의 조회 end ---
```

Accept-Language: [https://github.com/muyaaho/http-basic/blob/main/docs/7.http-header1.md#협상과-우선순위-1](https://github.com/muyaaho/http-basic/blob/main/docs/7.http-header1.md#%ED%98%91%EC%83%81%EA%B3%BC-%EC%9A%B0%EC%84%A0%EC%88%9C%EC%9C%84-1)

쿠키: [https://github.com/muyaaho/http-basic/blob/main/docs/7.http-header1.md#쿠키](https://github.com/muyaaho/http-basic/blob/main/docs/7.http-header1.md#%EC%BF%A0%ED%82%A4)

[Content 편의 조회]에서 `request.getContentType() = null`이 나오는데 이는 [get 방식](https://github.com/muyaaho/http-basic/blob/main/docs/4.http-method.md#get)이기 때문이다. post로 하면 결과를 볼 수 있다.

<img src=https://github.com/muyaaho/spring-mvc1/assets/76798969/88d9ce9c-6399-4511-8969-47dc94f8a64f width="80%" height="80%"/><br>

postman을 사용해 post 요청 보내기

```
[Content 편의 조회]
request.getContentType() = text/plain
request.getContentLength() = 6
request.getCharacterEncoding() = UTF-8
```

content 내용이 나오는 것을 확인할 수 있다.

#### 기타 정보

```java
//기타 정보
private void printEtc(HttpServletRequest request) {
    System.out.println("--- 기타 조회 start ---");
    System.out.println("[Remote 정보]");
    System.out.println("request.getRemoteHost() = " +
            request.getRemoteHost()); //
    System.out.println("request.getRemoteAddr() = " +
            request.getRemoteAddr()); //
    System.out.println("request.getRemotePort() = " +
            request.getRemotePort()); //
    System.out.println();
    System.out.println("[Local 정보]");
    System.out.println("request.getLocalName() = " + request.getLocalName()); //
    System.out.println("request.getLocalAddr() = " + request.getLocalAddr()); //
    System.out.println("request.getLocalPort() = " + request.getLocalPort()); //
    System.out.println("--- 기타 조회 end ---");
    System.out.println();
}
```

```
--- 기타 조회 start ---
[Remote 정보]
request.getRemoteHost() = 0:0:0:0:0:0:0:1
request.getRemoteAddr() = 0:0:0:0:0:0:0:1
request.getRemotePort() = 50102

[Local 정보]
request.getLocalName() = 0:0:0:0:0:0:0:1
request.getLocalAddr() = 0:0:0:0:0:0:0:1
request.getLocalPort() = 8080
--- 기타 조회 end ---

```
